
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tree-based methods &#8212; Data explorations</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/brain.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Data explorations</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Data explorations
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Phase 1 - Assessing the scene
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/art-of-data-investigations.html">
   Art of data investigations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../art-of-data-investigations.html">
     Art of data investigations
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/the-value-of-openness.html">
   The value of openness
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../the-value-of-openness.html">
     The value of openness
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../discussions/the-value-of-openness.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/what-is-a-theory.html">
   What is a theory?
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../discussions/what-is-a-theory.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/constructing-a-testable-hypothesis.html">
   Constructing a testable hypothesis
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../discussions/constructing-a-testable-hypothesis.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Phase 2 - Evaluating the evidence
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/data-as-objects-and-architectures.html">
   Data as objects and architectures
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-as-objects-and-architectures.html">
     Data as objects and architectures
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../discussions/data-as-objects-and-architectures.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/techniques-for-data-cleansing.html">
   Techniques for data cleansing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../techniques-for-data-cleansing.html">
     Techniques for data cleansing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../discussions/techniques-for-data-cleansing.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/visualization-as-analysis.html">
   Visualization as analysis
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../visualization-as-analysis.html">
     Visualization as analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../discussions/visualization-as-analysis.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/a-visualization-vocabulary.html">
   A visualization vocabulary
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../discussions/a-visualization-vocabulary.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/what-is-learnable.html">
   What is learnable?
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="simple">
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/the-bias-variance-tradeoff.html">
   The bias-variance tradeoff
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../discussions/the-bias-variance-tradeoff.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/linear-models.html">
   Linear models
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../linear-models.html">
     Linear models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../discussions/linear-models.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/the-ordinary-least-squares-solution.html">
   The ordinary least squares solution
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../the-ordinary-least-squares-solution.html">
     The ordinary least squares solution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../discussions/the-ordinary-least-squares-solution.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/limits-of-linear-regression.html">
   Limits of linear regression
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../limits-of-linear-regression.html">
     Limits of linear regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../discussions/limits-of-linear-regression.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/mixed-effects-models.html">
   Mixed effects models
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../mixed-effects-models.html">
     Mixed-effects models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../discussions/mixed-effects-models.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/classifiers.html">
   Classifiers
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../classifiers.html">
     Classifiers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../discussions/classifiers.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/the-beauty-of-knn.html">
   The beauty of kNN
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
  <label for="toctree-checkbox-16">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../the-beauty-of-knn.html">
     The beauty of kNN
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/cross-validation.html">
   Cross validation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
  <label for="toctree-checkbox-17">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../cross-validation.html">
     Cross-validation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../discussions/cross-validation.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/resampling-methods.html">
   Resampling methods
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
  <label for="toctree-checkbox-18">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../resampling-methods.html">
     Resampling methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../discussions/resampling-methods.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/power-analysis-via-simulations.html">
   Power analysis via simulations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
  <label for="toctree-checkbox-19">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../power-analysis-via-simulations.html">
     Power analysis via simulations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../discussions/power-analysis-via-simulations.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/mediation-and-moderation.html">
   Mediation and moderation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
  <label for="toctree-checkbox-20">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../mediation-and-moderation.html">
     Mediation and moderation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../discussions/mediation-and-moderation.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/selecting-the-best-model.html">
   Selecting the best model
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
  <label for="toctree-checkbox-21">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../selecting-the-best-model.html">
     Selecting the best model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../discussions/selecting-the-best-model.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/regularized-regression.html">
   Regularized regression
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/>
  <label for="toctree-checkbox-22">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../regularized-regression.html">
     Regularized regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../discussions/regularized-regression.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/principal-component-methods.html">
   The value of openness
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/>
  <label for="toctree-checkbox-23">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../principal-component-methods.html">
     Principal component methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../discussions/principal-component-methods.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Phase 3 - Solving the mystery
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/reconsidering-the-p-value.html">
   Reconsidering the p-value
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/>
  <label for="toctree-checkbox-24">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../discussions/reconsidering-the-p-value.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/bayes-factor-accepting-the-null.html">
   Bayes factor: accepting the null
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" type="checkbox"/>
  <label for="toctree-checkbox-25">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../bayes-factor-accepting-the-null.html">
     Bayes factor: accepting the null
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../discussions/bayes-factor-accepting-the-null.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/telling-your-data-story.html">
   Telling your data story
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" type="checkbox"/>
  <label for="toctree-checkbox-26">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../discussions/telling-your-data-story.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/notebooks/old/22 - Decision trees.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/CoAxLab/Data-Explorations/main?urlpath=tree/book/notebooks/old/22 - Decision trees.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/CoAxLab/Data-Explorations/blob/main/book/notebooks/old/22 - Decision trees.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Tree-based methods
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#goals-of-the-lab">
   Goals of the lab:
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pros-and-cons-of-trees-the-statistical-ones">
   Pros and cons of trees (the statistical ones)
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#some-solutions">
   Some solutions
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fitting-classification-trees">
   Fitting classification trees
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fitting-trees-to-predict-continuous-variables-aka-regression-trees">
   Fitting trees to predict continuous variables (AKA, “regression trees”)
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="tree-based-methods">
<h1>Tree-based methods<a class="headerlink" href="#tree-based-methods" title="Permalink to this headline">¶</a></h1>
<p>In this lab, we will go over how to implement decision trees with our data.</p>
</div>
<div class="section" id="goals-of-the-lab">
<h1>Goals of the lab:<a class="headerlink" href="#goals-of-the-lab" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>Learn to use the <code class="docutils literal notranslate"><span class="pre">tree</span></code> library to build classification trees &amp; regression trees.</p></li>
</ul>
<p>This lab draws from the practice sets at the end of Chapter 8 in James, G., Witten, D., Hastie, T., &amp; Tibshirani, R. (2013). “An introduction to statistical learning: with applications in r.”</p>
</div>
<div class="section" id="pros-and-cons-of-trees-the-statistical-ones">
<h1>Pros and cons of trees (the statistical ones)<a class="headerlink" href="#pros-and-cons-of-trees-the-statistical-ones" title="Permalink to this headline">¶</a></h1>
<p><strong>Pros:</strong></p>
<ul class="simple">
<li><p>Trees are interpretable. They are amenable to visualization and their visualization can be easily interpreted (if they are small).</p></li>
<li><p>Trees can handle qualitative predictors without having to create dummy variables.</p></li>
</ul>
<p><strong>Cons:</strong></p>
<ul class="simple">
<li><p>However, trees do not generally have the same predictive accuracy as other regression and classification approaches.</p></li>
<li><p>Trees can be sensitive to small changes in the data (i.e., flexible), so that even small differences in the data used to construct trees can result in drastically different decision trees.</p></li>
</ul>
</div>
<div class="section" id="some-solutions">
<h1>Some solutions<a class="headerlink" href="#some-solutions" title="Permalink to this headline">¶</a></h1>
<p>To minimize these shortcomings, you can aggregate many decision trees using <em>bagging</em>, <em>random forests</em>, and <em>boosting</em> (see the next lecture and tutorial for more info on these).</p>
</div>
<hr class="docutils" />
<div class="tex2jax_ignore mathjax_ignore section" id="fitting-classification-trees">
<h1>Fitting classification trees<a class="headerlink" href="#fitting-classification-trees" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># install.packages(&quot;ISLR&quot;)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ISLR</span><span class="p">)</span> <span class="c1"># Loading ISLR because this is where the Carseats dataset is.</span>

<span class="c1"># install.packages(&#39;tree&#39;) #uncomment to install </span>
<span class="nf">library</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span> <span class="c1">#this is the library needed for tree regression and classification</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Installing package into ‘/usr/local/lib/R/site-library’
(as ‘lib’ is unspecified)

Installing package into ‘/usr/local/lib/R/site-library’
(as ‘lib’ is unspecified)
</pre></div>
</div>
</div>
</div>
<p>To start, we are going to construct a classification tree using the <code class="docutils literal notranslate"><span class="pre">Carseats</span></code> dataset. This data set is describes sales of child car seats at 400 different stores. Here, <code class="docutils literal notranslate"><span class="pre">Sales</span></code> is a continuous variable (in “thousands of dollars” units), so we will binarize it for compatiblity with classification trees.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># ?Carseats # Uncomment for more info on the &quot;carseats &quot;</span>
<span class="nf">head</span><span class="p">(</span><span class="n">Carseats</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 6 × 11</caption>
<thead>
	<tr><th></th><th scope=col>Sales</th><th scope=col>CompPrice</th><th scope=col>Income</th><th scope=col>Advertising</th><th scope=col>Population</th><th scope=col>Price</th><th scope=col>ShelveLoc</th><th scope=col>Age</th><th scope=col>Education</th><th scope=col>Urban</th><th scope=col>US</th></tr>
	<tr><th></th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td> 9.50</td><td>138</td><td> 73</td><td>11</td><td>276</td><td>120</td><td>Bad   </td><td>42</td><td>17</td><td>Yes</td><td>Yes</td></tr>
	<tr><th scope=row>2</th><td>11.22</td><td>111</td><td> 48</td><td>16</td><td>260</td><td> 83</td><td>Good  </td><td>65</td><td>10</td><td>Yes</td><td>Yes</td></tr>
	<tr><th scope=row>3</th><td>10.06</td><td>113</td><td> 35</td><td>10</td><td>269</td><td> 80</td><td>Medium</td><td>59</td><td>12</td><td>Yes</td><td>Yes</td></tr>
	<tr><th scope=row>4</th><td> 7.40</td><td>117</td><td>100</td><td> 4</td><td>466</td><td> 97</td><td>Medium</td><td>55</td><td>14</td><td>Yes</td><td>Yes</td></tr>
	<tr><th scope=row>5</th><td> 4.15</td><td>141</td><td> 64</td><td> 3</td><td>340</td><td>128</td><td>Bad   </td><td>38</td><td>13</td><td>Yes</td><td>No </td></tr>
	<tr><th scope=row>6</th><td>10.81</td><td>124</td><td>113</td><td>13</td><td>501</td><td> 72</td><td>Bad   </td><td>78</td><td>16</td><td>No </td><td>Yes</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#if sales are &lt;= $8000, then sales are not high </span>
<span class="c1"># otherwise, they are. </span>
<span class="n">Carseats</span><span class="o">$</span><span class="n">High</span> <span class="o">&lt;-</span> <span class="nf">as.factor</span><span class="p">(</span><span class="nf">ifelse</span><span class="p">(</span><span class="n">Carseats</span><span class="o">$</span><span class="n">Sales</span><span class="o">&lt;=</span><span class="m">8</span><span class="p">,</span> <span class="s">&quot;No&quot;</span><span class="p">,</span> <span class="s">&quot;Yes&quot;</span><span class="p">)</span> <span class="p">)</span> <span class="c1"># Binarize and add to data.frame</span>
</pre></div>
</div>
</div>
</div>
<p>Now we’ll use the <code class="docutils literal notranslate"><span class="pre">tree</span></code> function to fit a classification tree. This will predict <code class="docutils literal notranslate"><span class="pre">High</span></code> using all variables except <code class="docutils literal notranslate"><span class="pre">Sales</span></code> (which we transformed above into <code class="docutils literal notranslate"><span class="pre">High</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tree.carseats</span> <span class="o">&lt;-</span> <span class="nf">tree</span><span class="p">(</span><span class="n">High</span><span class="o">~</span><span class="n">.</span><span class="o">-</span><span class="n">Sales</span><span class="p">,</span> <span class="n">Carseats</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The summary of the tree will list the variables used as nodes in the tree, the number of terminal nodes, and the training error rate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">summary</span><span class="p">(</span><span class="n">tree.carseats</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Classification tree:
tree(formula = High ~ . - Sales, data = Carseats)
Variables actually used in tree construction:
[1] &quot;ShelveLoc&quot;   &quot;Price&quot;       &quot;Income&quot;      &quot;CompPrice&quot;   &quot;Population&quot; 
[6] &quot;Advertising&quot; &quot;Age&quot;         &quot;US&quot;         
Number of terminal nodes:  27 
Residual mean deviance:  0.4575 = 170.7 / 373 
Misclassification error rate: 0.09 = 36 / 400 
</pre></div>
</div>
</div>
</div>
<p>You can see that the training error rate was 9%. The residual mean deviance is also reported. A small deviance indicates a tree that fits the training data well. The residual mean deviance is the deviance divided by the number of observations (<span class="math notranslate nohighlight">\(n\)</span>) subtracted from the number of terminal nodes in the tree (<span class="math notranslate nohighlight">\(|T_0|\)</span>).</p>
<p>In this case, the deviance is <span class="math notranslate nohighlight">\(170.7\)</span>. There are 400 observations for Sales, and 27 terminal nodes, so <span class="math notranslate nohighlight">\((n-|T_0|)\)</span> is <span class="math notranslate nohighlight">\(373\)</span>.</p>
<p>Now let’s plot the tree we’ve constructed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">plot</span><span class="p">(</span><span class="n">tree.carseats</span><span class="p">)</span> <span class="c1">#this will create the basic tree structure</span>
<span class="nf">text</span><span class="p">(</span><span class="n">tree.carseats</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="m">0</span><span class="p">)</span> <span class="c1">#this will annotate the tree with predictors and outcomes</span>
<span class="c1">#pretty=0 means that the tree will display the full names of the qualitative predictors instead of </span>
<span class="c1">#single-letter abbreviations </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/22 - Decision trees_13_0.png" src="../../_images/22 - Decision trees_13_0.png" />
</div>
</div>
<p>The most important indicator of sales seems to be the shelving location, because the first branch splits subsequent branches according to whether shelving location is bad or medium.</p>
<p>You can also just type the tree object name to see output for each branch of the tree. Below, the split criterion is displayed (<span class="math notranslate nohighlight">\(Price&lt;92.5\)</span>), the number of observations for each branch is shown, the deviance, the overall prediction for that branch, and the number of observations in that branch that take on the values <span class="math notranslate nohighlight">\(Yes\)</span> or <span class="math notranslate nohighlight">\(No\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tree.carseats</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>node), split, n, deviance, yval, (yprob)
      * denotes terminal node

  1) root 400 541.500 No ( 0.59000 0.41000 )  
    2) ShelveLoc: Bad,Medium 315 390.600 No ( 0.68889 0.31111 )  
      4) Price &lt; 92.5 46  56.530 Yes ( 0.30435 0.69565 )  
        8) Income &lt; 57 10  12.220 No ( 0.70000 0.30000 )  
         16) CompPrice &lt; 110.5 5   0.000 No ( 1.00000 0.00000 ) *
         17) CompPrice &gt; 110.5 5   6.730 Yes ( 0.40000 0.60000 ) *
        9) Income &gt; 57 36  35.470 Yes ( 0.19444 0.80556 )  
         18) Population &lt; 207.5 16  21.170 Yes ( 0.37500 0.62500 ) *
         19) Population &gt; 207.5 20   7.941 Yes ( 0.05000 0.95000 ) *
      5) Price &gt; 92.5 269 299.800 No ( 0.75465 0.24535 )  
       10) Advertising &lt; 13.5 224 213.200 No ( 0.81696 0.18304 )  
         20) CompPrice &lt; 124.5 96  44.890 No ( 0.93750 0.06250 )  
           40) Price &lt; 106.5 38  33.150 No ( 0.84211 0.15789 )  
             80) Population &lt; 177 12  16.300 No ( 0.58333 0.41667 )  
              160) Income &lt; 60.5 6   0.000 No ( 1.00000 0.00000 ) *
              161) Income &gt; 60.5 6   5.407 Yes ( 0.16667 0.83333 ) *
             81) Population &gt; 177 26   8.477 No ( 0.96154 0.03846 ) *
           41) Price &gt; 106.5 58   0.000 No ( 1.00000 0.00000 ) *
         21) CompPrice &gt; 124.5 128 150.200 No ( 0.72656 0.27344 )  
           42) Price &lt; 122.5 51  70.680 Yes ( 0.49020 0.50980 )  
             84) ShelveLoc: Bad 11   6.702 No ( 0.90909 0.09091 ) *
             85) ShelveLoc: Medium 40  52.930 Yes ( 0.37500 0.62500 )  
              170) Price &lt; 109.5 16   7.481 Yes ( 0.06250 0.93750 ) *
              171) Price &gt; 109.5 24  32.600 No ( 0.58333 0.41667 )  
                342) Age &lt; 49.5 13  16.050 Yes ( 0.30769 0.69231 ) *
                343) Age &gt; 49.5 11   6.702 No ( 0.90909 0.09091 ) *
           43) Price &gt; 122.5 77  55.540 No ( 0.88312 0.11688 )  
             86) CompPrice &lt; 147.5 58  17.400 No ( 0.96552 0.03448 ) *
             87) CompPrice &gt; 147.5 19  25.010 No ( 0.63158 0.36842 )  
              174) Price &lt; 147 12  16.300 Yes ( 0.41667 0.58333 )  
                348) CompPrice &lt; 152.5 7   5.742 Yes ( 0.14286 0.85714 ) *
                349) CompPrice &gt; 152.5 5   5.004 No ( 0.80000 0.20000 ) *
              175) Price &gt; 147 7   0.000 No ( 1.00000 0.00000 ) *
       11) Advertising &gt; 13.5 45  61.830 Yes ( 0.44444 0.55556 )  
         22) Age &lt; 54.5 25  25.020 Yes ( 0.20000 0.80000 )  
           44) CompPrice &lt; 130.5 14  18.250 Yes ( 0.35714 0.64286 )  
             88) Income &lt; 100 9  12.370 No ( 0.55556 0.44444 ) *
             89) Income &gt; 100 5   0.000 Yes ( 0.00000 1.00000 ) *
           45) CompPrice &gt; 130.5 11   0.000 Yes ( 0.00000 1.00000 ) *
         23) Age &gt; 54.5 20  22.490 No ( 0.75000 0.25000 )  
           46) CompPrice &lt; 122.5 10   0.000 No ( 1.00000 0.00000 ) *
           47) CompPrice &gt; 122.5 10  13.860 No ( 0.50000 0.50000 )  
             94) Price &lt; 125 5   0.000 Yes ( 0.00000 1.00000 ) *
             95) Price &gt; 125 5   0.000 No ( 1.00000 0.00000 ) *
    3) ShelveLoc: Good 85  90.330 Yes ( 0.22353 0.77647 )  
      6) Price &lt; 135 68  49.260 Yes ( 0.11765 0.88235 )  
       12) US: No 17  22.070 Yes ( 0.35294 0.64706 )  
         24) Price &lt; 109 8   0.000 Yes ( 0.00000 1.00000 ) *
         25) Price &gt; 109 9  11.460 No ( 0.66667 0.33333 ) *
       13) US: Yes 51  16.880 Yes ( 0.03922 0.96078 ) *
      7) Price &gt; 135 17  22.070 No ( 0.64706 0.35294 )  
       14) Income &lt; 46 6   0.000 No ( 1.00000 0.00000 ) *
       15) Income &gt; 46 11  15.160 Yes ( 0.45455 0.54545 ) *
</pre></div>
</div>
</div>
</div>
<p>Now let’s estimate the test error of this classification tree.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">set.seed </span><span class="p">(</span><span class="m">2</span><span class="p">)</span>
<span class="n">idx</span> <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="nf">nrow</span><span class="p">(</span><span class="n">Carseats</span><span class="p">)</span>
<span class="n">test</span><span class="o">=</span><span class="nf">sample</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="m">100</span><span class="p">)</span> <span class="c1">#sample 50 for the test set</span>
<span class="n">tune</span> <span class="o">=</span> <span class="nf">sample</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="o">-</span><span class="n">test</span><span class="p">],</span> <span class="m">150</span><span class="p">)</span> <span class="c1">#150 for the tuning set</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="o">!</span><span class="p">(</span><span class="n">idx</span> <span class="o">%in%</span> <span class="nf">c</span><span class="p">(</span><span class="n">tune</span><span class="p">,</span> <span class="n">test</span><span class="p">))]</span> <span class="c1">##select indices that are not in tune or test</span>
<span class="n">Carseats.tune</span><span class="o">=</span><span class="n">Carseats</span><span class="p">[</span><span class="n">tune</span><span class="p">,]</span> <span class="c1">#indices for test set</span>
<span class="n">Carseats.test</span><span class="o">=</span><span class="n">Carseats</span><span class="p">[</span><span class="n">test</span><span class="p">,]</span>
<span class="n">Carseats.train</span><span class="o">=</span><span class="n">Carseats</span><span class="p">[</span><span class="n">train</span><span class="p">,]</span> 

<span class="n">High.test</span><span class="o">=</span><span class="n">Carseats</span><span class="o">$</span><span class="n">High</span><span class="p">[</span><span class="n">test</span><span class="p">]</span> <span class="c1">#get test data</span>
<span class="c1">#tree.carseats=tree(High~.-Sales, Carseats, subset=c(tune,train)) #hacked model</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">tune</span><span class="p">,</span><span class="n">train</span><span class="p">)))</span>
<span class="n">tree.carseats</span><span class="o">=</span><span class="nf">tree</span><span class="p">(</span><span class="n">High</span><span class="o">~</span><span class="n">.</span><span class="o">-</span><span class="n">Sales</span><span class="p">,</span> <span class="n">Carseats</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">tune</span><span class="p">)</span> <span class="c1">#tuned model</span>
<span class="n">tree.pred</span><span class="o">=</span><span class="nf">predict</span><span class="p">(</span><span class="n">tree.carseats</span><span class="p">,</span> <span class="n">Carseats.test</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;class&quot;</span><span class="p">)</span> <span class="c1">#make a prediction using the test set</span>
<span class="c1">#class instructs R to return the class prediction</span>
<span class="nf">table</span><span class="p">(</span><span class="n">tree.pred</span><span class="p">,</span> <span class="n">High.test</span><span class="p">)</span> <span class="c1">#compare predictions with test data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 300
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         High.test
tree.pred No Yes
      No  50  13
      Yes 10  27
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#total_accuracy = (51 + 25) / length(test) #test accuracy for the hacked model</span>
<span class="n">total_accuracy</span> <span class="o">=</span> <span class="p">(</span><span class="m">50</span> <span class="o">+</span> <span class="m">27</span><span class="p">)</span> <span class="o">/</span> <span class="nf">length</span><span class="p">(</span><span class="n">test</span><span class="p">)</span> <span class="c1">#test accuracy for the tuned model</span>
<span class="n">total_accuracy</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">0.77</div></div>
</div>
<p>Now let’s prune the tree to determine the optimal level of complexity. The function
<code class="docutils literal notranslate"><span class="pre">cv.tree</span></code> will perform cross-validation to determine the complexity that maximizes the bias-variance tradeoff.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">set.seed</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
<span class="n">cv.carseats</span> <span class="o">=</span> <span class="nf">cv.tree</span><span class="p">(</span><span class="n">tree.carseats</span><span class="p">,</span> <span class="n">FUN</span><span class="o">=</span><span class="n">prune.misclass</span><span class="p">)</span> 
<span class="c1">#FUN=prune.misclass indicates that we want classification error rate to guide the </span>
<span class="c1">#cross-validated pruning process </span>
<span class="nf">names</span><span class="p">(</span><span class="n">cv.carseats</span><span class="p">)</span> <span class="c1">#this function reports the terminal number of nodes </span>
<span class="c1">#for each tree considered (size), the corresponding error rate (dev),</span>
<span class="c1">#and the value of the cost complexity parameter (k, corresponding to alpha)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>'size'</li><li>'dev'</li><li>'k'</li><li>'method'</li></ol>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">cv.carseats</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>$size
[1] 15 11 10  8  6  4  3  1

$dev
[1] 38 37 34 37 37 40 46 67

$k
[1] -Inf  0.0  1.0  2.0  2.5  3.0  6.0 12.0

$method
[1] &quot;misclass&quot;

attr(,&quot;class&quot;)
[1] &quot;prune&quot;         &quot;tree.sequence&quot;
</pre></div>
</div>
</div>
</div>
<p>It appears that the tree with 9 terminal nodes results in the lowest cross-validated error rate, with 50 cross-validation errors. Below is the CV error rate as function of tree size.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">plot</span><span class="p">(</span><span class="n">cv.carseats</span><span class="o">$</span><span class="n">size</span> <span class="p">,</span><span class="n">cv.carseats</span><span class="o">$</span><span class="n">dev</span> <span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s">&quot;b&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/22 - Decision trees_24_0.png" src="../../_images/22 - Decision trees_24_0.png" />
</div>
</div>
<p>Now we can apply the <code class="docutils literal notranslate"><span class="pre">prune.misclass()</span></code> function to prune the tree to have the number of nodes to match the best CV error above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#prune.carseats=prune.misclass(tree.carseats,best=14) #hacked model</span>
<span class="n">tree.carseats</span><span class="o">=</span><span class="nf">tree</span><span class="p">(</span><span class="n">High</span><span class="o">~</span><span class="n">.</span><span class="o">-</span><span class="n">Sales</span><span class="p">,</span> <span class="n">Carseats</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">train</span><span class="p">)</span> <span class="c1">#tuned model</span>
<span class="n">prune.carseats</span><span class="o">=</span><span class="nf">prune.misclass</span><span class="p">(</span><span class="n">tree.carseats</span><span class="p">,</span><span class="n">best</span><span class="o">=</span><span class="m">10</span><span class="p">)</span> <span class="c1">#tuned model</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">prune.carseats</span><span class="p">)</span> <span class="c1">#plotting the newly pruned tree</span>
<span class="nf">text</span><span class="p">(</span><span class="n">prune.carseats</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="m">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/22 - Decision trees_26_0.png" src="../../_images/22 - Decision trees_26_0.png" />
</div>
</div>
<p>Let’s see how well this pruned tree classifies test set observations using the <code class="docutils literal notranslate"><span class="pre">predict</span></code> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tree.pred</span><span class="o">=</span><span class="nf">predict</span><span class="p">(</span><span class="n">prune.carseats</span><span class="p">,</span> <span class="n">Carseats.test</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;class&quot;</span><span class="p">)</span>
<span class="nf">table</span><span class="p">(</span><span class="n">tree.pred</span><span class="p">,</span> <span class="n">High.test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         High.test
tree.pred No Yes
      No  42  10
      Yes 18  30
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#total_pruned_accuracy = (52+27)/length(test) #hacked model accuracy</span>
<span class="n">total_pruned_accuracy</span> <span class="o">=</span> <span class="p">(</span><span class="m">42+30</span><span class="p">)</span><span class="o">/</span><span class="nf">length</span><span class="p">(</span><span class="n">test</span><span class="p">)</span> <span class="c1">#tuned model test</span>
<span class="n">total_pruned_accuracy</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">0.72</div></div>
</div>
<p>And voila! We’ve found a good decision tree that allows for reasonably good prediction accuracy, and pruned it so that it isn’t too overfitted to the training data.</p>
</div>
<hr class="docutils" />
<div class="tex2jax_ignore mathjax_ignore section" id="fitting-trees-to-predict-continuous-variables-aka-regression-trees">
<h1>Fitting trees to predict continuous variables (AKA, “regression trees”)<a class="headerlink" href="#fitting-trees-to-predict-continuous-variables-aka-regression-trees" title="Permalink to this headline">¶</a></h1>
<p>Now let’s fit a decision tree on the continuous variable, <code class="docutils literal notranslate"><span class="pre">Sales</span></code>, instead of the categorical variable <code class="docutils literal notranslate"><span class="pre">High</span></code> that we generated from it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">Carseats</span><span class="o">$</span><span class="n">High</span> <span class="o">&lt;-</span> <span class="kc">NULL</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
<span class="n">tree.sales</span><span class="o">=</span><span class="nf">tree</span><span class="p">(</span><span class="n">Sales</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="n">Carseats</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">train</span><span class="p">)</span> <span class="c1">#fit the regression tree, using same training set as in previous section. </span>
<span class="nf">summary</span><span class="p">(</span><span class="n">tree.sales</span><span class="p">)</span> <span class="c1">#summarize</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Regression tree:
tree(formula = Sales ~ ., data = Carseats, subset = train)
Variables actually used in tree construction:
[1] &quot;ShelveLoc&quot;   &quot;Price&quot;       &quot;CompPrice&quot;   &quot;Advertising&quot; &quot;Population&quot; 
Number of terminal nodes:  12 
Residual mean deviance:  1.772 = 145.3 / 82 
Distribution of residuals:
    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-2.83300 -0.82100  0.09407  0.00000  0.91890  2.65600 
</pre></div>
</div>
</div>
</div>
<p>Notice that the output of <code class="docutils literal notranslate"><span class="pre">summary()</span></code> indicates that only five of the ten possible variables have been used in constructing the regression tree.</p>
<p>In this case, the deviance is just the sum of the squared errors for the tree.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">plot</span><span class="p">(</span><span class="n">tree.sales</span><span class="p">)</span>
<span class="nf">text</span><span class="p">(</span><span class="n">tree.sales</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="m">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/22 - Decision trees_35_0.png" src="../../_images/22 - Decision trees_35_0.png" />
</div>
</div>
<p>Similar to when we were predicting <code class="docutils literal notranslate"><span class="pre">High</span></code>, the tree we’ve fit for <code class="docutils literal notranslate"><span class="pre">Sales</span></code> also splits first at <code class="docutils literal notranslate"><span class="pre">ShelveLoc</span></code>, so this variable is definitely an informative predictor of how well carseats are selling.</p>
<p>Now let’s prune the tree.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#first, let&#39;s look at the CV error as a function tree size</span>
<span class="n">cv.sales</span><span class="o">=</span><span class="nf">cv.tree</span><span class="p">(</span><span class="n">tree.sales</span><span class="p">)</span> 
<span class="nf">plot</span><span class="p">(</span><span class="n">cv.sales</span><span class="o">$</span><span class="n">size</span><span class="p">,</span> <span class="n">cv.sales</span><span class="o">$</span><span class="n">dev</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/22 - Decision trees_37_0.png" src="../../_images/22 - Decision trees_37_0.png" />
</div>
</div>
<p>Interestingly, when we’re predicting the continuous variable, the optimal number of nodes is just 2, whereas it was 10 when we were predicting <code class="docutils literal notranslate"><span class="pre">High</span></code>. Since we know trees are very sensitive to variability in the data, this may be because there is a lot of noise in the variable <code class="docutils literal notranslate"><span class="pre">Sales</span></code>, and getting a coarser-grained version of this information with <code class="docutils literal notranslate"><span class="pre">High</span></code> decreases how quickly overfitting becomes a problem.</p>
<p>Let’s prune the tree based on these results, and then use it to make predictions on a test set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">prune.sales</span><span class="o">=</span><span class="nf">prune.tree</span><span class="p">(</span><span class="n">tree.sales</span><span class="p">,</span><span class="n">best</span><span class="o">=</span><span class="m">2</span><span class="p">)</span> <span class="c1">#manually selecting a 2-node tree</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">prune.sales</span><span class="p">)</span>
<span class="nf">text</span><span class="p">(</span><span class="n">prune.sales</span><span class="p">,</span><span class="n">pretty</span><span class="o">=</span><span class="m">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/22 - Decision trees_39_0.png" src="../../_images/22 - Decision trees_39_0.png" />
</div>
</div>
<p>This is a very simple model, but let’s trust our cross-validation model that this is the best way to avoid overfitting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">yhat</span><span class="o">=</span><span class="nf">predict</span><span class="p">(</span><span class="n">prune.sales</span><span class="p">,</span><span class="n">newdata</span><span class="o">=</span><span class="n">Carseats</span><span class="p">[</span><span class="o">-</span><span class="n">train</span> <span class="p">,])</span> <span class="c1"># Use the tree sales</span>
<span class="n">sales.test</span><span class="o">=</span><span class="n">Carseats</span><span class="p">[</span><span class="o">-</span><span class="n">train</span><span class="p">,</span> <span class="s">&quot;Sales&quot;</span><span class="p">]</span> <span class="c1"># extract the correct predictions for the test trials</span>
<span class="nf">require</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="nf">data.frame</span><span class="p">(</span><span class="n">yhat</span><span class="o">=</span><span class="n">yhat</span><span class="p">,</span><span class="n">sales.test</span><span class="o">=</span><span class="n">sales.test</span><span class="p">),</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">yhat</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">sales.test</span><span class="p">))</span> <span class="o">+</span> 
    <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span> 
    <span class="nf">geom_abline</span><span class="p">(</span><span class="n">slope</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">intercept</span><span class="o">=</span><span class="m">0</span><span class="p">)</span>
<span class="nf">mean</span><span class="p">((</span><span class="n">yhat</span><span class="o">-</span><span class="n">sales.test</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">6.26253927637412</div><img alt="../../_images/22 - Decision trees_41_1.png" src="../../_images/22 - Decision trees_41_1.png" />
</div>
</div>
<p>The test set MSE associated with the regression tree is
6.263. The square root of the MSE is therefore around 2.5, indicating
that this model leads to test predictions that are within around $2,500 of
actual carseat sales.</p>
<p>Note how ugly this plot is - the two groups are the observations that ended up in each of the two branches of the tree. Since the <span class="math notranslate nohighlight">\(\hat{y}\)</span> values are just the mean of all the training observations that ended up in that branch, there are only two possible <span class="math notranslate nohighlight">\(\hat{y}\)</span> values in this case.</p>
<p>Bagging and boosting may help us get a more accurate and generalizable fit for this data set - see the next tutorial to find out!</p>
<p><em>Notebook authored by Ven Popov and edited by Krista Bond, Charles Wu, Patience Stevens, and Amy Sentis.</em></p>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            kernelName: "ir",
            path: "./notebooks/old"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Timothy Verstynen, Venn Popov, Krista Bond, Charles Wu, Patience Stevens, Amy Sentis<br/>
        
            &copy; Copyright 2022.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>