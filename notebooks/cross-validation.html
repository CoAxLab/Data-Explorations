
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tutorial: Implementing cross validation &#8212; Data explorations</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Discussion questions" href="../discussions/cross-validation.html" />
    <link rel="prev" title="Cross validation" href="../lectures/cross-validation.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/brain.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Data explorations</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Data explorations
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Phase 1 - Assessing the scene
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/art-of-data-investigations.html">
   Art of data investigations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="art-of-data-investigations.html">
     Tutorial: Getting started
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/the-value-of-openness.html">
   The value of openness
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="the-value-of-openness.html">
     Tutorial: Repositories and version control
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/the-value-of-openness.html">
     Discussion questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/what-is-a-theory.html">
   What is a theory?
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/what-is-a-theory.html">
     Discussion questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/constructing-a-testable-hypothesis.html">
   Constructing a testable hypothesis
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="constructing-a-testable-hypothesis.html">
     Tutorial: Introduction to functions and good coding habits
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/constructing-a-testable-hypothesis.html">
     Discussion questions
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Phase 2 - Evaluating the evidence
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/data-as-objects-and-architectures.html">
   Data as objects and architectures
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="data-as-objects-and-architectures.html">
     Tutorial: Tidy data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/data-as-objects-and-architectures.html">
     Discussion questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/techniques-for-data-cleansing.html">
   Techniques for data cleansing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="techniques-for-data-cleansing.html">
     Tutorial: Data cleansing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/techniques-for-data-cleansing.html">
     Discussion questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/visualization-as-analysis.html">
   Visualization as analysis
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="visualization-as-analysis.html">
     Tutorial: Basics of plotting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/visualization-as-analysis.html">
     Discussion questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/visualization-through-human-eyes.html">
   Visualization through human eyes
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="visualization-through-human-eyes.html">
     Tutorial: More advanced plotting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/visualization-through-human-eyes.html">
     Discussion questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/the-bias-variance-tradeoff.html">
   The bias-variance tradeoff
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="the-bias-variance-tradeoff.html">
     Tutorial: Fitting and prediction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/the-bias-variance-tradeoff.html">
     Discussion questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/linear-models.html">
   Linear models
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="linear-models.html">
     Tutorial: Refresher on working with matrices
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/linear-models.html">
     Discussion questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/the-ordinary-least-squares-solution.html">
   The ordinary least squares solution
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="the-ordinary-least-squares-solution.html">
     Tutorial: Refresher for solving oridinary least squares
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/the-ordinary-least-squares-solution.html">
     Discussion questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/limits-of-linear-regression.html">
   Limits and variations of linear regression
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/limits-of-linear-regression.html">
     Discussion questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/mixed-effects-models.html">
   Mixed effects models
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="mixed-effects-models.html">
     Tutorial: Running linear mixed effects models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/mixed-effects-models.html">
     Discussion questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/classifiers.html">
   Classifiers
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="classifiers.html">
     Tutorial: Basics classifiers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/classifiers.html">
     Discussion questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/the-beauty-of-knn.html">
   The beauty of kNN
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="the-beauty-of-knn.html">
     Tutorial: Running kNN models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/the-beauty-of-knn.html">
     Discussion questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../lectures/cross-validation.html">
   Cross validation
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
  <label for="toctree-checkbox-16">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Tutorial: Implementing cross validation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/cross-validation.html">
     Discussion questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/resampling-methods.html">
   Resampling methods
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
  <label for="toctree-checkbox-17">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="resampling-methods.html">
     Tutorial: Boostrap and permutation tests
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/resampling-methods.html">
     Discussion questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/power-analysis-via-simulations.html">
   Power analysis via simulations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
  <label for="toctree-checkbox-18">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="power-analysis-via-simulations.html">
     Tutorial: Running basic power analyses
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/power-analysis-via-simulations.html">
     Discussion questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/mediation-and-moderation.html">
   Mediation and moderation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
  <label for="toctree-checkbox-19">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="mediation-and-moderation.html">
     Tutorial: Running mediation and moderation models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/mediation-and-moderation.html">
     Discussion questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/selecting-the-best-model.html">
   Selecting the best model
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
  <label for="toctree-checkbox-20">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="selecting-the-best-model.html">
     Tutorial: Model selection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/selecting-the-best-model.html">
     Discussion questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/regularized-regression.html">
   Regularized regression
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
  <label for="toctree-checkbox-21">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="regularized-regression.html">
     Tutorial: Basic ridge and LASSO models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/regularized-regression.html">
     Discussion questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/principal-component-methods.html">
   Principal component methods
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/>
  <label for="toctree-checkbox-22">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="principal-component-methods.html">
     Tutorial: Basic PCA approaches
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/principal-component-methods.html">
     Discussion questions
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Phase 3 - Solving the mystery
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/reconsidering-the-p-value.html">
   Reconsidering the p-value
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/>
  <label for="toctree-checkbox-23">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/reconsidering-the-p-value.html">
     Discussion questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/bayes-factor-accepting-the-null.html">
   Bayes factor
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/>
  <label for="toctree-checkbox-24">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="bayes-factor-accepting-the-null.html">
     Tutorial: Estimating Bayes factors
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/bayes-factor-accepting-the-null.html">
     Discussion questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/telling-your-data-story.html">
   Telling your data story
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" type="checkbox"/>
  <label for="toctree-checkbox-25">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/telling-your-data-story.html">
     Discussion questions
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/notebooks/cross-validation.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/CoAxLab/Data-Explorations/main?urlpath=tree/book/notebooks/cross-validation.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/CoAxLab/Data-Explorations/blob/main/book/notebooks/cross-validation.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Tutorial: Implementing cross validation
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#goals">
     Goals:
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#why-not-use-the-simple-validation-set-approach">
   Why not use the simple validation set approach?
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#validation-data-sets">
   Validation data sets
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#leave-one-out-cross-validation-loocv">
   Leave-one-out cross-validation (LOOCV)
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#k-fold-cross-validation">
   K-fold cross validation
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="tutorial-implementing-cross-validation">
<h1>Tutorial: Implementing cross validation<a class="headerlink" href="#tutorial-implementing-cross-validation" title="Permalink to this headline">¶</a></h1>
<p>This lab focuses on how to implement cross-validation methods in R.</p>
<div class="section" id="goals">
<h2>Goals:<a class="headerlink" href="#goals" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Understand the limitations of the simple validation set approach, and the benefits of more refined approaches</p></li>
<li><p>Learn to use the <code class="docutils literal notranslate"><span class="pre">cv.glm()</span></code> function to implement</p>
<ul>
<li><p>leave-one-out cross-validation (LOOCV)</p></li>
<li><p>k-fold cross-validation (k-fold CV)</p></li>
</ul>
</li>
<li><p>Understand the bias-variance trade-off in the context of these resampling methods</p></li>
</ul>
<p>This lab draws from the practice sets at the end of Chapter 5 in James, G., Witten, D., Hastie, T., &amp; Tibshirani, R. (2013). “An introduction to statistical learning: with applications in r.”</p>
</div>
</div>
<hr class="docutils" />
<div class="tex2jax_ignore mathjax_ignore section" id="why-not-use-the-simple-validation-set-approach">
<h1>Why not use the simple validation set approach?<a class="headerlink" href="#why-not-use-the-simple-validation-set-approach" title="Permalink to this headline">¶</a></h1>
<p>Up until now, when we’ve wanted to “train” a model and then “test” it (such as in our demos of KNN in the previous tutorial), we’ve chosen a subset of the dataset to be test observations and then trained on the remainder. Although this is relatively simple and easy to implement, there are significant drawbacks.</p>
<ul class="simple">
<li><p>The validation estimate of the test error rate can be highly variable</p></li>
<li><p>Only a subset of observations (those in the training set) are used to train the model</p>
<ul>
<li><p>This limits the statistical power, and may lead to <em>overestimating</em> test error rate</p></li>
</ul>
</li>
</ul>
<p>Cross-validation, a reampling method used to partition your data into test and training sets, addresses both of these issues.</p>
<p>Let’s see how this is true.</p>
</div>
<hr class="docutils" />
<div class="tex2jax_ignore mathjax_ignore section" id="validation-data-sets">
<h1>Validation data sets<a class="headerlink" href="#validation-data-sets" title="Permalink to this headline">¶</a></h1>
<p>Here we will explore test error rates using cross-validation. We’ll be using the Auto data set again from the ISLR library.</p>
<p>First, we should acknowledge that you’ll need to reset the seed for your random number generator. For this use the <a class="reference external" href="https://www.rdocumentation.org/packages/simEd/versions/1.0.3/topics/set.seed"><em>set.seed()</em></a> function. We want to use the same seed as the book so that you get the same results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;ISLR&quot;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ISLR</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">1</span><span class="p">)</span> <span class="c1">#set the seed for the random number generator. resetting the seed will give different results.</span>

<span class="n">train</span><span class="o">=</span><span class="nf">sample</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="m">392</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">196</span><span class="p">)</span>  <span class="c1"># sample 196 indices from the vector 1:392</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Installing package into ‘/usr/local/lib/R/site-library’
(as ‘lib’ is unspecified)

── <span class=" -Color -Color-Bold">Attaching packages</span> ─────────────────────────────────────── tidyverse 1.3.0 ──

<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">ggplot2</span> 3.3.3     <span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">purrr  </span> 0.3.4
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">tibble </span> 3.0.5     <span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">dplyr  </span> 1.0.3
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">tidyr  </span> 1.1.2     <span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">stringr</span> 1.4.0
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">readr  </span> 1.4.0     <span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">forcats</span> 0.5.0

── <span class=" -Color -Color-Bold">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──
<span class=" -Color -Color-Red">✖</span> <span class=" -Color -Color-Blue">dplyr</span>::<span class=" -Color -Color-Green">filter()</span> masks <span class=" -Color -Color-Blue">stats</span>::filter()
<span class=" -Color -Color-Red">✖</span> <span class=" -Color -Color-Blue">dplyr</span>::<span class=" -Color -Color-Green">lag()</span>    masks <span class=" -Color -Color-Blue">stats</span>::lag()
</pre></div>
</div>
</div>
</div>
<p>Above we choose 196 unique random samples out of a list ranging from 1-392. These indices will identify our training set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">Auto</span><span class="p">,</span><span class="nf">aes</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span><span class="n">horsepower</span><span class="p">))</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/cross-validation_5_0.png" src="../_images/cross-validation_5_0.png" />
</div>
</div>
<p>Now let’s fit some models doing the training-testing approach that we’ve used so far in this class.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate a linear model using the training subset</span>
<span class="n">lm.fit</span> <span class="o">=</span> <span class="nf">lm</span><span class="p">(</span><span class="n">mpg</span><span class="o">~</span><span class="n">horsepower</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">Auto</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">train</span><span class="p">)</span>
<span class="nf">mean</span><span class="p">((</span><span class="n">Auto</span><span class="o">$</span><span class="n">mpg</span><span class="o">-</span><span class="nf">predict</span><span class="p">(</span><span class="n">lm.fit</span><span class="p">,</span><span class="n">Auto</span><span class="p">))[</span><span class="o">-</span><span class="n">train</span><span class="p">]</span><span class="o">^</span><span class="m">2</span><span class="p">)</span> <span class="c1"># Mean Squared Error (MSE) for test set</span>

<span class="c1"># Use the poly() function to estimate test error</span>
<span class="c1"># for polynomial and cubic regressions</span>
<span class="c1"># 2nd degree polynomial</span>
<span class="n">lm.fit2</span> <span class="o">=</span> <span class="nf">lm</span><span class="p">(</span><span class="n">Auto</span><span class="o">$</span><span class="n">mpg</span><span class="o">~</span><span class="nf">poly</span><span class="p">(</span><span class="n">horsepower</span><span class="p">,</span><span class="m">4</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">Auto</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">train</span><span class="p">)</span>
<span class="nf">mean</span><span class="p">((</span><span class="n">Auto</span><span class="o">$</span><span class="n">mpg</span><span class="o">-</span><span class="nf">predict</span><span class="p">(</span><span class="n">lm.fit2</span><span class="p">,</span><span class="n">Auto</span><span class="p">))[</span><span class="o">-</span><span class="n">train</span><span class="p">]</span><span class="o">^</span><span class="m">2</span><span class="p">)</span> <span class="c1"># Mean Squared Error (MSE) for test set</span>

<span class="c1"># 3rd degree polynomial</span>
<span class="n">lm.fit3</span> <span class="o">=</span> <span class="nf">lm</span><span class="p">(</span><span class="n">Auto</span><span class="o">$</span><span class="n">mpg</span><span class="o">~</span><span class="nf">poly</span><span class="p">(</span><span class="n">horsepower</span><span class="p">,</span><span class="m">6</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">Auto</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">train</span><span class="p">)</span>
<span class="nf">mean</span><span class="p">((</span><span class="n">Auto</span><span class="o">$</span><span class="n">mpg</span><span class="o">-</span><span class="nf">predict</span><span class="p">(</span><span class="n">lm.fit3</span><span class="p">,</span><span class="n">Auto</span><span class="p">))[</span><span class="o">-</span><span class="n">train</span><span class="p">]</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">23.2660086465003</div><div class="output text_html">19.1601734630785</div><div class="output text_html">19.5946481598143</div></div>
</div>
<p>So the MSE we observe for the linear and the two polynomial models (quadratic &amp; cubic) is 26.14, 19.82, and 19.78 respectively. <strong>But these exact values are sensitive to the particular subset we selected.</strong> Let’s repeat this selecting a different subset of the Auto data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Notice that if we use a different subsample we&#39;d get different results</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">2</span><span class="p">)</span> <span class="c1">#using a different seed </span>
<span class="n">train</span><span class="o">=</span><span class="nf">sample</span><span class="p">(</span><span class="m">392</span><span class="p">,</span><span class="m">196</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Linear model</span>
<span class="n">lm.fit</span> <span class="o">=</span> <span class="nf">lm</span><span class="p">(</span><span class="n">mpg</span><span class="o">~</span><span class="n">horsepower</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">Auto</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">train</span><span class="p">)</span>
<span class="nf">mean</span><span class="p">((</span><span class="n">Auto</span><span class="o">$</span><span class="n">mpg</span><span class="o">-</span><span class="nf">predict</span><span class="p">(</span><span class="n">lm.fit</span><span class="p">,</span><span class="n">Auto</span><span class="p">))[</span><span class="o">-</span><span class="n">train</span><span class="p">]</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>

<span class="c1"># Polynomial</span>
<span class="n">lm.fit2</span> <span class="o">=</span> <span class="nf">lm</span><span class="p">(</span><span class="n">mpg</span><span class="o">~</span><span class="nf">poly</span><span class="p">(</span><span class="n">horsepower</span><span class="p">,</span><span class="m">4</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">Auto</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">train</span><span class="p">)</span>
<span class="nf">mean</span><span class="p">((</span><span class="n">Auto</span><span class="o">$</span><span class="n">mpg</span><span class="o">-</span><span class="nf">predict</span><span class="p">(</span><span class="n">lm.fit2</span><span class="p">,</span><span class="n">Auto</span><span class="p">))[</span><span class="o">-</span><span class="n">train</span><span class="p">]</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>

<span class="c1"># Cubic</span>
<span class="n">lm.fit3</span> <span class="o">=</span> <span class="nf">lm</span><span class="p">(</span><span class="n">mpg</span><span class="o">~</span><span class="nf">poly</span><span class="p">(</span><span class="n">horsepower</span><span class="p">,</span><span class="m">6</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">Auto</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">train</span><span class="p">)</span>
<span class="nf">mean</span><span class="p">((</span><span class="n">Auto</span><span class="o">$</span><span class="n">mpg</span><span class="o">-</span><span class="nf">predict</span><span class="p">(</span><span class="n">lm.fit3</span><span class="p">,</span><span class="n">Auto</span><span class="p">))[</span><span class="o">-</span><span class="n">train</span><span class="p">]</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">25.7265106448139</div><div class="output text_html">20.3090205440697</div><div class="output text_html">19.616933858347</div></div>
</div>
<p>This is a smaller demonstration of what is shown in figure 5.2 of James, G., Witten, D., Hastie, T., &amp; Tibshirani, R. (2013). “An introduction to statistical learning: with applications in r.”. Depending on the specific training set we use, the test error estimate can vary substantially.</p>
</div>
<hr class="docutils" />
<div class="tex2jax_ignore mathjax_ignore section" id="leave-one-out-cross-validation-loocv">
<h1>Leave-one-out cross-validation (LOOCV)<a class="headerlink" href="#leave-one-out-cross-validation-loocv" title="Permalink to this headline">¶</a></h1>
<p>Leave-one-out cross-validation (LOOCV) repeatedly splits the set of <span class="math notranslate nohighlight">\(n\)</span> data points into a training set (blue) that has all except one observation, and a validation set that has only a single observation (beige). The test error is estimated by averaging the <span class="math notranslate nohighlight">\(n\)</span> resulting MSEs. Below, the first training set contains everything except observation 1, the second training set contains everything except observation 2, and this continues until <span class="math notranslate nohighlight">\(n\)</span> training sets are created and tested.</p>
<p>The <a class="reference external" href="https://cran.r-project.org/web/packages/boot/boot.pdf"><em>boot</em></a> library in R has many tools to perform LOOCV using a model fit object. Let’s try performing LOOCV using the <code class="docutils literal notranslate"><span class="pre">glm()</span></code> function and the <code class="docutils literal notranslate"><span class="pre">cv.glm()</span></code> function.</p>
<p>We’ll start with a simple linear regression model predicting <code class="docutils literal notranslate"><span class="pre">mpg</span></code> from <code class="docutils literal notranslate"><span class="pre">horsepower</span></code>, using the full data set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Continue with the Auto example</span>
<span class="n">glm.fit</span> <span class="o">=</span> <span class="nf">glm</span><span class="p">(</span><span class="n">mpg</span><span class="o">~</span><span class="n">horsepower</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">Auto</span><span class="p">)</span>
<span class="nf">coef</span><span class="p">(</span><span class="n">glm.fit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.dl-inline {width: auto; margin:0; padding: 0}
.dl-inline>dt, .dl-inline>dd {float: none; width: auto; display: inline-block}
.dl-inline>dt::after {content: ":\0020"; padding-right: .5ex}
.dl-inline>dt:not(:first-of-type) {padding-left: .5ex}
</style><dl class=dl-inline><dt>(Intercept)</dt><dd>39.9358610211705</dd><dt>horsepower</dt><dd>-0.157844733353654</dd></dl>
</div></div>
</div>
<p>Now let’s use LOOCV, via the <code class="docutils literal notranslate"><span class="pre">cv.glm()</span></code> function, to estimate the cross validated MSE per the following equation.</p>
<div class="math notranslate nohighlight">
\[ CV_{(n)} = \frac{1}{n} \sum_{i=1}^{n} MSE_i \]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">boot</span><span class="p">)</span> <span class="c1"># Load the bootstrap library</span>
<span class="o">?</span><span class="nf">cv.glm</span><span class="p">()</span> <span class="c1">#uncomment to get more information about this function</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">glm.fit</span> <span class="o">=</span> <span class="nf">glm</span><span class="p">(</span><span class="n">mpg</span><span class="o">~</span><span class="n">horsepower</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">Auto</span><span class="p">)</span>
<span class="n">cv.err</span>  <span class="o">=</span> <span class="nf">cv.glm</span><span class="p">(</span><span class="n">Auto</span><span class="p">,</span> <span class="n">glm.fit</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="nf">nrow</span><span class="p">(</span><span class="n">Auto</span><span class="p">))</span> <span class="c1">#if you don&#39;t define k in the cv.glm() function, the default is LOOCV</span>
<span class="n">cv.err</span><span class="o">$</span><span class="n">delta</span> 
<span class="c1"># ^^ note: the prediction error function for cv.glm() is MSE by default - but you can change that with &quot;cost&quot; variable</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>24.2315135179292</li><li>24.2311440937562</li></ol>
</div></div>
</div>
<p>The first entry of <code class="docutils literal notranslate"><span class="pre">cv.err$delta</span></code> is the raw cross-validation estimate of prediction error (equation above) and the second is the adjusted cross-validation estimate designed to compensate for the bias introduced by not using leave-one-out cross-validation. The thing is, we <em>did</em> use leave-one-out cross-validation (<code class="docutils literal notranslate"><span class="pre">K=nrow(Auto)</span></code>), so the two values above are very close. But for smaller values of K (i.e., fewer groupings or folds over which cross-validation is run) the bias is greater and thus the error is also greater. The “corrected” value on the right estimates what the estimated MSE would be if we’d used LOOCV instead. Try changing <code class="docutils literal notranslate"><span class="pre">K</span></code> to a smaller value to see how the difference between the left and right <code class="docutils literal notranslate"><span class="pre">delta</span></code> values changes.</p>
<p><em>As noted in the textbook reading, there are some advantages to the bias introduced using smaller values of <code class="docutils literal notranslate"><span class="pre">K</span></code> - LOOCV isn’t always the superior method.</em></p>
<p>Let’s look at LOOCV MSE estimates for polynomial regression (this may take a minute or two to run).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Repeat for polynomial models up to a factor of 10</span>
<span class="n">cv.error</span> <span class="o">=</span> <span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">10</span><span class="p">)</span> <span class="c1"># specify your output object - where you&#39;ll save the MSE estimates for each poly value</span>
<span class="n">start.time</span> <span class="o">&lt;-</span> <span class="nf">Sys.time</span><span class="p">()</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">glm.fit</span><span class="o">=</span><span class="nf">glm</span><span class="p">(</span><span class="n">mpg</span><span class="o">~</span><span class="nf">poly</span><span class="p">(</span><span class="n">horsepower</span><span class="p">,</span><span class="n">i</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">Auto</span><span class="p">)</span>
    <span class="n">cv.error</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nf">cv.glm</span><span class="p">(</span><span class="n">Auto</span><span class="p">,</span> <span class="n">glm.fit</span><span class="p">)</span><span class="o">$</span><span class="n">delta</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="c1"># do LOO crossval for polynomial fits from 1 to 10</span>
<span class="p">}</span>
<span class="n">end.time</span> <span class="o">&lt;-</span> <span class="nf">Sys.time</span><span class="p">()</span>
<span class="n">LOOtime</span> <span class="o">&lt;-</span> <span class="n">end.time</span><span class="o">-</span><span class="n">start.time</span> <span class="c1"># how long did this for-loop take to run? </span>
<span class="nf">plot</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span><span class="n">cv.error</span><span class="p">)</span> <span class="c1"># plot the error</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/cross-validation_20_0.png" src="../_images/cross-validation_20_0.png" />
</div>
</div>
<p>The first entry in the <code class="docutils literal notranslate"><span class="pre">cv.error</span></code> array is the linear model we estimated above. Notice that we get an initial improvement in accuracy when you move to the 2nd order polynomial, but more complex models (i.e., higher order polynomials) only provide a modest decrease in error. This suggests it would be worth upgrading to a 2nd order polynomial model, but the benefits to increasing the complexity of our model drop off after that. This makes sense when you look at a 2nd order polynomical fit to the data (below) - adding extra bends in the curve won’t improve the error much more. We can trust what the “test” error is telling us about the best model fit more because we used LOOCV instead of the simpler, set-aside-random-test-items approach.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">mpg</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="n">Auto</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span> <span class="nf">stat_smooth</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;lm&quot;</span><span class="p">,</span> <span class="n">formula</span> <span class="o">=</span> <span class="n">y</span> <span class="o">~</span> <span class="nf">poly</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="m">2</span><span class="p">),</span> <span class="n">se</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/cross-validation_22_0.png" src="../_images/cross-validation_22_0.png" />
</div>
</div>
</div>
<hr class="docutils" />
<div class="tex2jax_ignore mathjax_ignore section" id="k-fold-cross-validation">
<h1>K-fold cross validation<a class="headerlink" href="#k-fold-cross-validation" title="Permalink to this headline">¶</a></h1>
<p>In 5-fold cross validation, the set of <span class="math notranslate nohighlight">\(n\)</span> observations is randomly split into five unique groups. Each fifth of the dataset acts as a validation set, and the remainder is the training set. The average of the five resulting MSE estimates is the test error.</p>
<p>As stated above, the default <em>k</em> for the <code class="docutils literal notranslate"><span class="pre">cv.glm()</span></code> function is <em>k=n</em> (i.e., LOOCV). If you don’t want to do LOOCV (if, for example, you have MANY observations and LOOCV would take too long) you can specify the number of folds as an input to the function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reset the seed</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">17</span><span class="p">)</span>

<span class="c1"># Repeat our previous loop  but use K-fold CV </span>
<span class="c1"># where K = 10 and up to a 5th order polynomial</span>
<span class="n">cv.error.10</span> <span class="o">=</span> <span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">10</span><span class="p">)</span> <span class="c1"># Always have to specify your output object</span>
<span class="n">start.time</span> <span class="o">&lt;-</span> <span class="nf">Sys.time</span><span class="p">()</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">){</span>
  <span class="n">glm.fit</span><span class="o">=</span><span class="nf">glm</span><span class="p">(</span><span class="n">mpg</span><span class="o">~</span><span class="nf">poly</span><span class="p">(</span><span class="n">horsepower</span><span class="p">,</span><span class="n">i</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">Auto</span><span class="p">)</span> <span class="c1">#get the glm fit for all 10 polynomials</span>
  <span class="n">cv.error.10</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nf">cv.glm</span><span class="p">(</span><span class="n">Auto</span><span class="p">,</span> <span class="n">glm.fit</span><span class="p">,</span><span class="n">K</span><span class="o">=</span><span class="m">10</span><span class="p">)</span><span class="o">$</span><span class="n">delta</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">end.time</span> <span class="o">&lt;-</span> <span class="nf">Sys.time</span><span class="p">()</span>
<span class="n">Kfoldtime</span> <span class="o">&lt;-</span> <span class="n">end.time</span><span class="o">-</span><span class="n">start.time</span> <span class="c1"># how long did this for-loop take to run?</span>

<span class="nf">plot</span><span class="p">(</span><span class="n">cv.error</span><span class="p">,</span> <span class="n">cv.error.10</span><span class="p">,</span> <span class="n">xlab</span><span class="o">=</span><span class="s">&quot;LOOCV error&quot;</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="s">&quot;10-fold CV error&quot;</span><span class="p">)</span>
<span class="nf">lines</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">19</span><span class="p">,</span><span class="m">25</span><span class="p">),</span><span class="nf">c</span><span class="p">(</span><span class="m">19</span><span class="p">,</span><span class="m">25</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/cross-validation_26_0.png" src="../_images/cross-validation_26_0.png" />
</div>
</div>
<p>Notice how similar the results are for 10-fold CV &amp; LOOCV. Since we measured how long the leave-one-out and 10-fold methods took to run, we can compare the run times:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="s">&quot;Leave-one-out runtime:&quot;</span><span class="p">,</span><span class="n">LOOtime</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="s">&quot;10-fold runtime:&quot;</span><span class="p">,</span><span class="n">Kfoldtime</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] &quot;Leave-one-out runtime: 16.6454846858978&quot;
[1] &quot;10-fold runtime: 0.475992202758789&quot;
</pre></div>
</div>
</div>
</div>
<p>As you can see, 10-fold was much quicker to run.</p>
<p><em>Notebook authored by Ven Popov and edited by Krista Bond, Charles Wu, Patience Stevens, and Amy Sentis.</em></p>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            kernelName: "ir",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="../lectures/cross-validation.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Cross validation</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../discussions/cross-validation.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Discussion questions</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Timothy Verstynen, Venn Popov, Krista Bond, Charles Wu, Patience Stevens, Amy Sentis<br/>
        
            &copy; Copyright 2022.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>