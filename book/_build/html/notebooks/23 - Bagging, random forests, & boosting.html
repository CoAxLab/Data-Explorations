
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bagging and random forests &#8212; Data explorations</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/brain.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Data explorations</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Data explorations
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Phase 1 - Assessing the scene
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/the-value-of-openness.html">
   The value of openness
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="01-Introduction-to-data-investigations.html">
     The art of “data poetry”
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/the-value-of-openness.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/what-is-a-theory.html">
   What is a theory?
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/what-is-a-theory.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/constructing-a-testable-hypothesis.html">
   Constructing a testable hypothesis
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="04%20-%20VSNCONTROLINTRO%20-%20Constructing%20a%20testable%20hypothesis.html">
     1. Why version control?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/constructing-a-testable-hypothesis.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Phase 2 - Evaluating the evidence
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/data-as-objects-and-architectures.html">
   Data as objects and architectures
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="05%20-%20Data%20as%20objects%20and%20architectures.html">
     Tutorial: Data processing in R
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/data-as-objects-and-architectures.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/techniques-for-data-cleansing.html">
   Techniques for data cleansing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="06%20-%20Techniques%20for%20data%20cleansing.html">
     Model objects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/techniques-for-data-cleansing.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/visualization-as-analysis.html">
   Visualization as analysis
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="07%20-%20Visualization%20as%20analysis.html">
     Plotting &amp; distributions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/visualization-as-analysis.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/a-visualization-vocabulary.html">
   A visualization vocabulary
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/a-visualization-vocabulary.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/what-is-learnable.html">
   What is learnable?
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="simple">
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/the-bias-variance-tradeoff.html">
   The bias-variance tradeoff
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/the-bias-variance-tradeoff.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/linear-models.html">
   Linear models
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="09%20-%20Linear%20models.html">
     Vectors
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/linear-models.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/the-ordinary-least-squares-solution.html">
   The ordinary least squares solution
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="10%20-%20Least%20squares%20and%20model%20evaluation.html">
     Derivatives
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/the-ordinary-least-squares-solution.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/limits-of-linear-regression.html">
   Limits of linear regression
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="11%20-%20Limits%20of%20linear%20models.html">
     Linear regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/limits-of-linear-regression.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/mixed-effects-models.html">
   Mixed effects models
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="12%20-%20Mixed%20effect%20models.html">
     Linear mixed-effects models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/mixed-effects-models.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/classifiers.html">
   Classifiers
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="13%20-%20Classifiers.html">
     Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/classifiers.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/the-beauty-of-knn.html">
   The beauty of kNN
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="14%20-%20The%20beauty%20of%20kNN.html">
     K-Nearest Neighbors: An Intro
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/cross-validation.html">
   Cross validation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
  <label for="toctree-checkbox-16">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="15%20-%20Cross%20validation.html">
     Cross-validation methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/cross-validation.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/resampling-methods.html">
   Resampling methods
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
  <label for="toctree-checkbox-17">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="16%20-%20Resampling%20methods.html">
     More on resampling &amp; randomization methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/resampling-methods.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/power-analysis-via-simulations.html">
   Power analysis via simulations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
  <label for="toctree-checkbox-18">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="17%20-%20Power%20analyses%20via%20simulations.html">
     Simulating power
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/power-analysis-via-simulations.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/mediation-and-moderation.html">
   Mediation and moderation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
  <label for="toctree-checkbox-19">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="18%20-%20Mediation%2C%20moderation%2C%20%26%20graphs.html">
     Mediation and Moderation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/mediation-and-moderation.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/selecting-the-best-model.html">
   Selecting the best model
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
  <label for="toctree-checkbox-20">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="20%20-%20Selecting%20the%20best%20model.html">
     Subset selection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/selecting-the-best-model.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/regularized-regression.html">
   Regularized regression
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
  <label for="toctree-checkbox-21">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="19%20-%20Regularized%20regression.html">
     Ridge Regression &amp; Lasso
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/regularized-regression.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/principal-component-methods.html">
   The value of openness
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/>
  <label for="toctree-checkbox-22">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="21%20-%20Principal%20component%20methods.html">
     Principal Component Methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/principal-component-methods.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Phase 3 - Solving the mystery
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/reconsidering-the-p-value.html">
   Reconsidering the p-value
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/>
  <label for="toctree-checkbox-23">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/reconsidering-the-p-value.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/bayes-factor-accepting-the-null.html">
   Bayes factor: accepting the null
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/>
  <label for="toctree-checkbox-24">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="25%20-%20Bayes%20factor%20accepting%20the%20null.html">
     Embracing the gradient: A brief tour of Bayes Factor implementation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/bayes-factor-accepting-the-null.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lectures/telling-your-data-story.html">
   Telling your data story
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" type="checkbox"/>
  <label for="toctree-checkbox-25">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../discussions/telling-your-data-story.html">
     Discussion questions:
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/notebooks/23 - Bagging, random forests, & boosting.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/CoAxLab/Data-Explorations/main?urlpath=tree/book/notebooks/23 - Bagging, random forests, & boosting.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/CoAxLab/Data-Explorations/blob/main/book/notebooks/23 - Bagging, random forests, & boosting.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Bagging and random forests
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#goals-of-the-lab">
     Goals of the lab:
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#boosting">
   Boosting
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="bagging-and-random-forests">
<h1>Bagging and random forests<a class="headerlink" href="#bagging-and-random-forests" title="Permalink to this headline">¶</a></h1>
<p>Now that we’re familiar with decision trees, let’s explore some additional ways to find a sufficiently compled but not overfitted tree, as well as ways to make some inferences about the data.</p>
<div class="section" id="goals-of-the-lab">
<h2>Goals of the lab:<a class="headerlink" href="#goals-of-the-lab" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Learn how to use the <code class="docutils literal notranslate"><span class="pre">randomForest</span></code> package to apply bagging and random forests to a sample dataset</p></li>
<li><p>Learn to use the <code class="docutils literal notranslate"><span class="pre">gbm</span></code> package to boost trees</p></li>
</ul>
<p>Now we will apply bagging and random forests, again to the <code class="docutils literal notranslate"><span class="pre">Carseats</span></code> dataset, using the <code class="docutils literal notranslate"><span class="pre">randomForest</span></code> package.</p>
<p>Bagging is just a special case of a random forest with <span class="math notranslate nohighlight">\(m=p\)</span>, so the <code class="docutils literal notranslate"><span class="pre">randomForest()</span></code> function can be used for both purposes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># install.packages(&#39;randomForest&#39;) # uncomment to install package</span>
<span class="nf">library</span><span class="p">(</span><span class="n">randomForest</span><span class="p">)</span>
<span class="c1"># install.packages(&#39;ISLR&#39;)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ISLR</span><span class="p">)</span> <span class="c1"># Loading ISLR because this is where the Carseats dataset is.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Installing package into ‘/usr/local/lib/R/site-library’
(as ‘lib’ is unspecified)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">set.seed </span><span class="p">(</span><span class="m">2</span><span class="p">)</span>
<span class="n">idx</span> <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="nf">nrow</span><span class="p">(</span><span class="n">Carseats</span><span class="p">)</span>
<span class="n">test</span><span class="o">=</span><span class="nf">sample</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="m">50</span><span class="p">)</span> <span class="c1">#sample 50 for the test set</span>
<span class="n">tune</span> <span class="o">=</span> <span class="nf">sample</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="o">-</span><span class="n">test</span><span class="p">],</span> <span class="m">150</span><span class="p">)</span> <span class="c1">#150 for the tuning set</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="n">test</span><span class="p">,</span><span class="n">tune</span><span class="p">)]</span> <span class="c1">##select indices that are not in tune or test</span>

<span class="n">bag.sales</span><span class="o">=</span><span class="nf">randomForest</span><span class="p">(</span><span class="n">Sales</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">Carseats</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">train</span><span class="p">,</span> <span class="n">mtry</span><span class="o">=</span><span class="m">10</span><span class="p">,</span>
                       <span class="n">importance</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span> <span class="c1"># runs the bagging.</span>
<span class="c1">#the arg. mtry=11 indicates that all 11 predictors should be considered</span>
<span class="c1">#for each split of the tree (i.e., bagging should be done, m=p)</span>
<span class="n">bag.sales</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
 randomForest(formula = Sales ~ ., data = Carseats, mtry = 10,      importance = TRUE, subset = train) 
               Type of random forest: regression
                     Number of trees: 500
No. of variables tried at each split: 10

          Mean of squared residuals: 2.992511
                    % Var explained: 62.29
</pre></div>
</div>
</div>
</div>
<p>Recall that “bagging” means we’re fitting a decision tree to each of many permutations of our <code class="docutils literal notranslate"><span class="pre">Carseats</span></code> data set (giving us a “forest” of trees). We’re then generating a prediction by taking the average of all those trees’ predictions for a given observation. Let’s look at the predicted values that this bagging technique generates for our test observations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#test set performance of this bagged regression</span>
<span class="n">sales.test</span> <span class="o">=</span> <span class="n">Carseats</span><span class="o">$</span><span class="n">Sales</span><span class="p">[</span><span class="o">-</span><span class="n">train</span><span class="p">]</span>
<span class="n">yhat.bag</span> <span class="o">=</span> <span class="nf">predict</span><span class="p">(</span><span class="n">bag.sales</span><span class="p">,</span> <span class="n">newdata</span><span class="o">=</span><span class="n">Carseats</span><span class="p">[</span><span class="o">-</span><span class="n">train</span> <span class="p">,])</span>
<span class="nf">require</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="nf">data.frame</span><span class="p">(</span><span class="n">yhat</span><span class="o">=</span><span class="n">yhat.bag</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">sales.test</span><span class="p">),</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">yhat</span><span class="p">))</span> <span class="o">+</span> 
    <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span> <span class="nf">geom_abline</span><span class="p">(</span><span class="n">slope</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">intercept</span><span class="o">=</span><span class="m">0</span><span class="p">)</span>
<span class="nf">mean</span><span class="p">((</span><span class="n">yhat.bag</span> <span class="o">-</span> <span class="n">sales.test</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">2.34591157277384</div><img alt="../_images/23 - Bagging, random forests, &amp; boosting_8_1.png" src="../_images/23 - Bagging, random forests, &amp; boosting_8_1.png" />
</div>
</div>
<p>The test set MSE associated with the bagged regression tree is ~2.34, much lower than that obtained using an optimally-pruned single tree in the last tutorial (6.26). Also notice that the predictions are no longer “binned” like they were in the prior tutorial - again, this is because each prediction is an average across many trees’ predictions, not just the output of a single tree.</p>
<p>We could change
the number of trees grown by randomForest() using the ntree argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">set.seed</span><span class="p">(</span><span class="m">4</span><span class="p">)</span>
<span class="n">bag.sales</span><span class="o">=</span><span class="nf">randomForest</span><span class="p">(</span><span class="n">Sales</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">Carseats</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">train</span><span class="p">,</span> <span class="n">mtry</span><span class="o">=</span><span class="m">10</span><span class="p">,</span>
                       <span class="n">importance</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">ntree</span><span class="o">=</span><span class="m">25</span><span class="p">)</span> <span class="c1">#grow 25 trees</span>
<span class="n">yhat.bag</span> <span class="o">=</span> <span class="nf">predict </span><span class="p">(</span><span class="n">bag.sales</span><span class="p">,</span><span class="n">newdata</span><span class="o">=</span><span class="n">Carseats</span><span class="p">[</span><span class="o">-</span><span class="n">train</span> <span class="p">,])</span>
<span class="nf">mean</span><span class="p">((</span><span class="n">yhat.bag</span><span class="o">-</span><span class="n">sales.test</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">2.53862951086978</div></div>
</div>
<p>Growing a random forest instead is implemented similarly. We just use a smaller value for the <code class="docutils literal notranslate"><span class="pre">mtry</span></code> argument. Note that, by default, randomForest() will use <span class="math notranslate nohighlight">\(p\)</span>/3 variables for building a random forest of regression trees, and <span class="math notranslate nohighlight">\(\sqrt p\)</span> variables for building a random forest of classification trees.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">set.seed</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
<span class="n">rf.sales</span><span class="o">=</span><span class="nf">randomForest</span><span class="p">(</span><span class="n">Sales</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">Carseats</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">train</span> <span class="p">,</span>
<span class="n">mtry</span><span class="o">=</span><span class="m">6</span><span class="p">,</span> <span class="n">importance</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="n">yhat.rf</span> <span class="o">=</span> <span class="nf">predict</span><span class="p">(</span><span class="n">rf.sales</span><span class="p">,</span> <span class="n">newdata</span><span class="o">=</span><span class="n">Carseats</span><span class="p">[</span><span class="o">-</span><span class="n">train</span> <span class="p">,])</span>
<span class="nf">mean</span><span class="p">((</span><span class="n">yhat.rf</span><span class="o">-</span><span class="n">sales.test</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">2.45013126005531</div></div>
</div>
<p>The test set MSE is ~2.45. Random forests yielded an
improvement over bagging in this case.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">importance()</span></code> function shows the importance of each variable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">importance</span><span class="p">(</span><span class="n">rf.sales</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A matrix: 10 × 2 of type dbl</caption>
<thead>
	<tr><th></th><th scope=col>%IncMSE</th><th scope=col>IncNodePurity</th></tr>
</thead>
<tbody>
	<tr><th scope=row>CompPrice</th><td>12.828147</td><td>142.431567</td></tr>
	<tr><th scope=row>Income</th><td> 4.002538</td><td> 99.699909</td></tr>
	<tr><th scope=row>Advertising</th><td>12.283050</td><td>123.400224</td></tr>
	<tr><th scope=row>Population</th><td>-4.442861</td><td> 54.708305</td></tr>
	<tr><th scope=row>Price</th><td>43.961604</td><td>438.751679</td></tr>
	<tr><th scope=row>ShelveLoc</th><td>53.619274</td><td>436.628853</td></tr>
	<tr><th scope=row>Age</th><td>14.210471</td><td>147.267610</td></tr>
	<tr><th scope=row>Education</th><td> 1.987748</td><td> 65.338171</td></tr>
	<tr><th scope=row>Urban</th><td>-1.670795</td><td>  9.161331</td></tr>
	<tr><th scope=row>US</th><td> 2.076824</td><td>  9.101008</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>This shows two metrics of importance, <code class="docutils literal notranslate"><span class="pre">%IncMSE</span></code> and <code class="docutils literal notranslate"><span class="pre">IncNodePurity</span></code> (see the James ISLR textbook, p. 330 for explanation).</p>
<p>You can visualize the relative importance of each variable using the below function. Here, we see that <code class="docutils literal notranslate"><span class="pre">ShelveLoc</span></code> and <code class="docutils literal notranslate"><span class="pre">Price</span></code> are the two most important predictor variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">varImpPlot</span><span class="p">(</span><span class="n">rf.sales</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/23 - Bagging, random forests, &amp; boosting_17_0.png" src="../_images/23 - Bagging, random forests, &amp; boosting_17_0.png" />
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="boosting">
<h1>Boosting<a class="headerlink" href="#boosting" title="Permalink to this headline">¶</a></h1>
<p>Here we’ll use the <code class="docutils literal notranslate"><span class="pre">gbm</span></code> package and the <code class="docutils literal notranslate"><span class="pre">gbm()</span></code> function to fit boosted regression trees, still using the <code class="docutils literal notranslate"><span class="pre">Carseats</span></code> dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># install.packages(&#39;gbm&#39;)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">gbm</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">set.seed </span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
<span class="n">boost.sales</span> <span class="o">=</span><span class="nf">gbm</span><span class="p">(</span><span class="n">Sales</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">Carseats</span><span class="p">[</span><span class="n">train</span> <span class="p">,],</span> <span class="n">distribution</span><span class="o">=</span>
                  <span class="s">&quot;gaussian&quot;</span><span class="p">,</span> <span class="n">n.trees</span><span class="o">=</span><span class="m">5000</span><span class="p">,</span> <span class="n">interaction.depth</span><span class="o">=</span><span class="m">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here, we’ll use gbm() with
distribution=”gaussian” because this is a regression problem. If it were binary
classification, we would use distribution=”bernoulli”. The
argument n.trees=5000 means that we want 5000 trees. The option
interaction.depth=4 limits the depth of each tree.</p>
<p><code class="docutils literal notranslate"><span class="pre">summary()</span></code> will produce a table of relative influence statistics for each variable, and a relative influence plot.</p>
<p>You can see that lstat and rm are the most important variables.</p>
<p>See p. 331 for an extension of this called partial dependence plots. These plots show the marginal effect of selected variables on the outcome after accounting for the effect of the other variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">summary</span><span class="p">(</span><span class="n">boost.sales</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 10 × 2</caption>
<thead>
	<tr><th></th><th scope=col>var</th><th scope=col>rel.inf</th></tr>
	<tr><th></th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>Price</th><td>Price      </td><td>26.3976801</td></tr>
	<tr><th scope=row>ShelveLoc</th><td>ShelveLoc  </td><td>21.7573639</td></tr>
	<tr><th scope=row>CompPrice</th><td>CompPrice  </td><td>13.0507087</td></tr>
	<tr><th scope=row>Age</th><td>Age        </td><td>10.1364627</td></tr>
	<tr><th scope=row>Advertising</th><td>Advertising</td><td> 9.6807429</td></tr>
	<tr><th scope=row>Income</th><td>Income     </td><td> 9.2179495</td></tr>
	<tr><th scope=row>Population</th><td>Population </td><td> 6.2685891</td></tr>
	<tr><th scope=row>Education</th><td>Education  </td><td> 2.6010816</td></tr>
	<tr><th scope=row>Urban</th><td>Urban      </td><td> 0.6003349</td></tr>
	<tr><th scope=row>US</th><td>US         </td><td> 0.2890865</td></tr>
</tbody>
</table>
</div><img alt="../_images/23 - Bagging, random forests, &amp; boosting_24_1.png" src="../_images/23 - Bagging, random forests, &amp; boosting_24_1.png" />
</div>
</div>
<p>Now we’ll use the boosted model to predict <code class="docutils literal notranslate"><span class="pre">Sales</span></code> in the test set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">yhat.boost</span><span class="o">=</span><span class="nf">predict</span><span class="p">(</span><span class="n">boost.sales</span><span class="p">,</span><span class="n">newdata</span><span class="o">=</span><span class="n">Carseats</span><span class="p">[</span><span class="o">-</span><span class="n">train</span> <span class="p">,],</span>
<span class="n">n.trees</span><span class="o">=</span><span class="m">5000</span><span class="p">)</span>
<span class="nf">mean</span><span class="p">((</span><span class="n">yhat.boost</span> <span class="o">-</span> <span class="n">sales.test</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">2.02584604298047</div></div>
</div>
<p>The test MSE obtained is 2.03, which is the best test MSE we’ve gotten yet!</p>
<p><em>Note</em>: You can also construct boosted trees using a different value of the shrinkage parameter, <span class="math notranslate nohighlight">\(\lambda\)</span>, by specifying the shrinkage argument within the <code class="docutils literal notranslate"><span class="pre">gbm()</span></code> function. For example:</p>
<p><code class="docutils literal notranslate"><span class="pre">boost.sales</span> <span class="pre">=</span> <span class="pre">gbm(Sales</span> <span class="pre">∼.,data=Carseats[train</span> <span class="pre">,],</span> <span class="pre">distribution=</span> <span class="pre">&quot;gaussian</span> <span class="pre">&quot;,n.trees=5000</span> <span class="pre">,</span> <span class="pre">interaction.depth=4,</span> <span class="pre">shrinkage=0.2,</span> <span class="pre">verbose=F)</span></code></p>
<p><em>Notebook authored by Ven Popov and edited by Krista Bond, Charles Wu, and Patience Stevens</em></p>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            kernelName: "ir",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Timothy Verstynen, Venn Popov, Krista Bond, Charles Wu, Patience Stevens, Amy Sentis<br/>
        
            &copy; Copyright 2022.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>